<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Pinterest Manager</title>

    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background: #fafafa;
        }

        h1 {
            text-align: center;
            padding: 20px;
            font-weight: 600;
            color: #444;
        }

        /* Masonry-style layout */
        .grid {
            column-count: 5;
            column-gap: 14px;
            padding: 15px;
        }

        @media (max-width: 1200px) { .grid { column-count: 4; } }
        @media (max-width: 900px) { .grid { column-count: 3; } }
        @media (max-width: 600px) { .grid { column-count: 2; } }
        @media (max-width: 400px) { .grid { column-count: 1; } }

        .item {
            break-inside: avoid;
            margin-bottom: 14px;
            border-radius: 10px;
            overflow: hidden;
            background: white;
            box-shadow: 0px 4px 10px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: transform 0.1s ease-in-out;
        }

        .item:hover {
            transform: scale(1.02);
        }

        img {
            width: 100%;
            display: block;
        }

        .filename {
            padding: 8px 12px;
            font-size: 14px;
            color: #555;
            background: #fff;
        }
    </style>
</head>

<body>
    <h1>Pinterest Image Manager</h1>

    <div id="grid" class="grid"></div>

    <script>
        async function loadImages() {
            // Fetch directory listing from Axum ServeDir
            const res = await fetch("/");
            const text = await res.text();

            // Extract filenames from generated HTML directory listing (Axum)
            const regex = /href=\"([^\"]+)\"/g;
            const images = [];
            let match;

            while ((match = regex.exec(text)) !== null) {
                const file = match[1];
                if (file.match(/\.(jpg|jpeg|png|webp|gif|bmp)$/i)) {
                    images.push(file);
                }
            }

            const grid = document.getElementById("grid");

            images.forEach(src => {
                const item = document.createElement("div");
                item.className = "item";

                item.innerHTML = `
                    <img src="${src}" draggable="false">
                    <div class="filename">${src}</div>
                `;

                item.onclick = () => {
                    fetch("/open?src=" + encodeURIComponent(src));
                };

                grid.appendChild(item);
            });
        }

        loadImages();
    </script>
</body>
</html>
